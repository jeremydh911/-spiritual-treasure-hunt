name: Godot tests

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  godot-test:
    name: godot-test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Godot (headless) CLI
        run: |
          # download a known-good headless build; adjust version as needed
          GODOT_VERSION=4.2.0
          wget -qO godot.zip https://downloads.tuxfamily.org/godotengine/${GODOT_VERSION}/godot-${GODOT_VERSION}-linux.headless.64.zip
          unzip -q godot.zip -d /usr/local/bin
          chmod +x /usr/local/bin/godot
          godot --version

      - name: Run Godot headless tests (script)
        run: |
          chmod +x ./scripts/run-godot-tests.sh
          ./scripts/run-godot-tests.sh
