name: Godot tests

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  godot-test:
    name: godot-test
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Godot (headless) CLI
        run: |
          # download a known-good headless build; adjust version as needed
          GODOT_VERSION=4.2.4
          URL="https://downloads.tuxfamily.org/godotengine/${GODOT_VERSION}/godot-${GODOT_VERSION}-linux.headless.64.zip"
          echo "Attempting to fetch Godot from $URL"
          if wget -qO godot.zip "$URL"; then
            unzip -q godot.zip -d /usr/local/bin
            mv /usr/local/bin/godot-${GODOT_VERSION}-linux.headless.64 /usr/local/bin/godot || true
            chmod +x /usr/local/bin/godot
          else
            echo "Warning: failed to download Godot; tests may be skipped"
          fi
          godot --version || true

      - name: Run Godot headless tests (script)
        run: |
          chmod +x ./scripts/run-godot-tests.sh
          ./scripts/run-godot-tests.sh
